<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .container {
            background: #fff;
            padding: 40px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 350px;
            justify-content: center;
            margin: auto;
            text-align: center;
        }

        .error {
            color: red;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">
            <a href="Home.html">Costume Corner</a>
        </div>
        <div class="nav-links">
            <a href="Home.html">Home</a>
            <a href="Products.html">Products</a>
            <a href="Bookings.html">Bookings</a>
            <a href="AboutUs.html">About Us</a>
            <a href="LocateUs.html">Locate Us</a>
            <a href="BookNow.html">Book Now</a>
            <a href="Profile.html" class="profile-icon"><i class="fas fa-user"></i></a>
            <a href="Login.html" class="logout-icon"><i class="fas fa-sign-out-alt"></i></a>
        </div>
    </nav>

    <h1>User Profile</h1>
    <div>
        <p>Username: <span id="username"></span></p>
        <p>Email: <span id="email"></span></p>
        <p id="tokenExpirationStatus"></p>
    </div>
    <button onclick="window.location.href='Login.html'">Logout</button>

    <script>
        // Function to decode JWT token
        function decodeToken(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const decoded = atob(base64);  // Decode base64 string
            return JSON.parse(decoded);  // Parse JSON string
        }

        // Function to check if token is expired
        function checkTokenExpiration(expirationTime) {
            const currentTime = Math.floor(Date.now() / 1000); // Current time in seconds
            return expirationTime < currentTime;
        }

        // Check if token exists in localStorage
        const token = localStorage.getItem('authToken');
        if (token) {
            // Decode the token and extract user info
            const decodedToken = decodeToken(token);

            // Access the username and email from the decoded token (using string keys)
            const username = decodedToken.name || 'Username not available';  // 'name' is typically used for username
            const email = decodedToken.email || 'Email not available';
            const expirationTime = decodedToken.exp;

            // Display the user information
            document.getElementById('username').textContent = username;
            document.getElementById('email').textContent = email;

            // Check token expiration
            const isExpired = checkTokenExpiration(expirationTime);
            const expirationMessage = isExpired ? 'Token has expired.' : 'Token is valid.';
            document.getElementById('tokenExpirationStatus').textContent = expirationMessage;

        } else {
            // If no token found, redirect to login page
            window.location.href = 'Login.html';
        }
    </script>
</body>
</html>
